/*
 A JavaScript library for [map] BBCode parsing, displaying and editing.
 https://github.com/MapBBCode/mapbbcode
 (c) 2013, Ilya Zverev
 Licensed WTFPL.
*/
!function(window,document,undefined){L=window.L,window.MapBBCodeProcessor={decimalDigits:5,_getRegExp:function(){var t="\\s*(-?\\d+(?:\\.\\d+)?)\\s*,\\s*(-?\\d+(?:\\.\\d+)?)",e="\\((?:([a-zA-Z0-9,]*)\\|)?(|[\\s\\S]*?[^\\\\])\\)",o=t+"(?:"+t+")*(?:\\s*"+e+")?",i="\\[map(?:=([12]?\\d)(?:,"+t+")?)?\\]",n=i+"("+o+"(?:\\s*;"+o+")*)?\\s*\\[/map\\]",a=new RegExp(n,"i");return{coord:t,params:e,map:n,mapCompiled:a}},isValid:function(t){return this._getRegExp().mapCompiled.test(t)},stringToObjects:function(t){var e=this._getRegExp(),o=t.match(e.mapCompiled),i={objs:[]};if(o&&o[1]&&o[1].length&&+o[1]>0&&(i.zoom=+o[1],o[3]&&o[3].length>0))try{i.pos=L.LatLng?new L.LatLng(o[2],o[3]):[+o[2],+o[3]]}catch(n){}if(o&&o[4])for(var a=o[4].replace(/;;/g,"##%##").split(";"),r=new RegExp("^"+e.coord),s=new RegExp(e.params),l=0;l<a.length;l++){var p,d=a[l].replace(/##%##/g,";"),c=[],h="",u=[];for(p=d.match(r);p;)c.push(L.LatLng?new L.LatLng(p[1],p[2]):[+p[1],+p[2]]),d=d.substr(p[0].length),p=d.match(r);p=d.match(s),p&&(p[1]&&(u=p[1].split(",")),h=p[2].replace(/\\\)/g,")").replace(/^\s+|\s+$/g,"")),i.objs.push({coords:c,text:h,params:u})}return i},objectsToString:function(t){var e="";t.zoom>0&&(e="="+t.zoom,t.pos&&(e+=","+this._latLngToString(t.pos)));for(var o=[],i=[],n=t.objs||[],a=0;a<n.length;a++){for(var r=n[a].coords,s="",l=0;l<r.length;l++)l>0&&(s+=" "),s+=this._latLngToString(r[l]);var p=n[a].text||"",d=n[a].params||[];p.indexOf("|")>=0&&0===d.length&&(p="|"+p),(p.length>0||d.length>0)&&(s=s+"("+(d.length>0?d.join(",")+"|":"")+p.replace(/\)/g,"\\)").replace(/;/g,";;")+")"),r.length&&(1==r.length?o.push(s):i.push(s))}return o.length||i.length||e.length?"[map"+e+"]"+o.concat(i).join("; ")+"[/map]":""},_latLngToString:function(t){var e=Math.pow(10,this.decimalDigits);return""+Math.round((t.lat||t[0])*e)/e+","+Math.round((t.lng||t[1])*e)/e}},window.MapBBCode=L.Class.extend({options:{createLayers:null,layers:null,maxInitialZoom:15,defaultPosition:[22,11],defaultZoom:2,leafletOptions:{},polygonOpacity:.1,editorHeight:400,viewWidth:600,viewHeight:300,fullViewHeight:600,fullScreenButton:!0,fullFromStart:!1,windowWidth:800,windowHeight:500,windowFeatures:"resizable,status,dialog",usePreparedWindow:!0,editorCloseButtons:!0,libPath:"lib/",outerLinkTemplate:!1,helpButton:!0,allowedHTML:"[auib]|span|br|em|strong|tt",letterIconLength:2,popupIconLength:30,enablePolygons:!0,preferStandardLayerSwitcher:!0,decimalDigits:5,hideInsideClasses:[],externalEndpoint:"http://share.mapbbcode.org/",uploadButton:!1,shareTag:"mapid"},strings:{},initialize:function(t){L.setOptions(this,t),L.Browser.ie&&t&&t.defaultPosition&&"splice"in t.defaultPosition&&2==t.defaultPosition.length&&(this.options.defaultPosition=[t.defaultPosition[0],t.defaultPosition[1]])},setStrings:function(t){this.strings=L.extend({},this.strings,t)},_eachParamHandler:function(t,e,o){var i=window.MapBBCode.objectParams;if(i)for(var n=0;n<i.length;n++)(!o||i[n].applicableTo(o))&&t.call(e||this,i[n])},_objectToLayer:function(t){var e;return 1==t.coords.length?e=L.marker(t.coords[0]):t.coords.length>2&&t.coords[0].equals(t.coords[t.coords.length-1])?(t.coords.splice(t.coords.length-1,1),e=L.polygon(t.coords,{weight:3,opacity:.7,fill:!0,fillOpacity:this.options.polygonOpacity})):e=L.polyline(t.coords,{weight:5,opacity:.7}),this._eachParamHandler(function(o){for(var i=[],n=0;n<t.params.length;n++)o.reKeys.test(t.params[n])&&i.push(t.params[n]);o.objectToLayer(e,o.text?t.text:i,this)},this,e),e._objParams=t.params,e},_zoomToLayer:function(t,e,o,i){var n=e.getBounds();if(!n||!n.isValid())return o&&o.zoom?t.setView(o.pos||this.options.defaultPosition,o.zoom):i&&t.setView(this.options.defaultPosition,this.options.defaultZoom),void 0;var a=function(){if(o&&o.pos)t.setView(o.pos,o.zoom||this.options.maxInitialZoom);else{var e=Math.max(this.options.maxInitialZoom,i?0:t.getZoom());t.fitBounds(n,{animate:!1}),o&&o.zoom?t.setZoom(o.zoom,{animate:!1}):t.getZoom()>e&&t.setZoom(e,{animate:!1})}},r=t.getBoundsZoom(n,!1);r?a.call(this):t.on("load",a,this)},createOpenStreetMapLayer:function(){return L.tileLayer("http://tile.openstreetmap.org/{z}/{x}/{y}.png",{name:"OpenStreetMap",attribution:'Map &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>',minZoom:2,maxZoom:18})},_addLayers:function(t){var e=this.options.createLayers?this.options.createLayers.call(this,L):null;e&&e.length||!window.layerList||!this.options.layers||(e=window.layerList.getLeafletLayers(this.options.layers,L)),e&&e.length||(e=[this.createOpenStreetMapLayer()]);for(var o=0;o<e.length;o++)"OSM"===e[o]&&(e[o]=this.createOpenStreetMapLayer());if(t.addLayer(e[0]),e.length>1){var i,n;if(!this.options.preferStandardLayerSwitcher&&L.StaticLayerSwitcher){for(i=L.staticLayerSwitcher(),n=0;n<e.length;n++)i.addLayer(e[n].options.name,e[n]);t.addControl(i)}else{for(i=L.control.layers(),n=0;n<e.length;n++)i.addBaseLayer(e[n],e[n].options.name);t.addControl(i)}}},_hideClassPresent:function(t){if("string"!=typeof t.className)return!1;var e,o,i=t.className.split(" "),n=this.options.hideInsideClasses;if(!n||!n.length)return!1;for(e=0;e<i.length;e++)for(o=0;o<n.length;o++)if(i[e]===n[o])return!0;return t.parentNode&&this._hideClassPresent(t.parentNode)},_px:function(t){return t?t+"px":"100%"},_createMapPanel:function(t,e){var o="string"==typeof t?document.getElementById(t):t;if(o){for(var i=o.getAttribute("bbcode")||o.getAttribute("value")||o.innerHTML.replace(/^\s+|\s+$/g,"");o.firstChild;)o.removeChild(o.firstChild);if(e||!this._hideClassPresent(o)){var n=document.createElement("div");return n.style.width=e?"100%":this.options.fullFromStart?"100%":this._px(this.options.viewWidth),n.style.height=e?this._px(this.options.editorHeight):this.options.fullFromStart?this._px(this.options.fullViewHeight):this._px(this.options.viewHeight),o.appendChild(n),n.storedBBCode=i,n.close=function(){o.removeChild(n)},n}}},show:function(t,e){var o=this._createMapPanel(t);if(o&&(e||(e=o.storedBBCode),e&&"string"==typeof e)){var i=L.map(o,L.extend({},{scrollWheelZoom:!1,zoomControl:!1},this.options.leafletOptions));i.addControl(new L.Control.Zoom({zoomInTitle:this.strings.zoomInTitle,zoomOutTitle:this.strings.zoomOutTitle})),this._addLayers(i);var n=new L.FeatureGroup;n.addTo(i);for(var a=window.MapBBCodeProcessor.stringToObjects(e),r=a.objs,s=0;s<r.length;s++)this._objectToLayer(r[s]).addTo(n);if(this._zoomToLayer(i,n,{zoom:a.zoom,pos:a.pos},!0),this.options.fullScreenButton&&!this.options.fullFromStart){var l,p=new L.FunctionButton(window.MapBBCode.buttonsImage,{position:"topright",bgPos:[0,0],title:this.strings.fullScreenTitle}),d=!1;i.addControl(p),p.on("clicked",function(){var t=i.getContainer().style;d||l||(l=[t.width,t.height]),d=!d,t.width=d?"100%":l[0],t.height=d?this._px(this.options.fullViewHeight):l[1],i.invalidateSize(),p.setBgPos([d?26:0,0]),this._zoomToLayer(i,n)},this)}if(this.options.outerLinkTemplate){var c=L.functionButton(window.MapBBCode.buttonsImage,{position:"topright",bgPos:[52,0],title:this.strings.outerTitle});c.on("clicked",function(){var t=this.options.outerLinkTemplate;t=t.replace("{zoom}",i.getZoom()).replace("{lat}",i.getCenter().lat).replace("{lon}",i.getCenter().lng),window.open(t,"mapbbcode_outer")},this),i.addControl(c)}return{_ui:this,map:i,close:function(){this.map=null,this._ui=null,o.close()},getBBCode:function(){return e},updateBBCode:function(t,o){e=t;var a=window.MapBBCodeProcessor.stringToObjects(e),r=a.objs;n.clearLayers();for(var s=0;s<r.length;s++)this._ui._objectToLayer(r[s]).addTo(n);o||this._ui._zoomToLayer(i,n,{zoom:a.zoom,pos:a.pos},!0)},zoomToData:function(){this._ui._zoomToLayer(i,n)}}}}}),L.FunctionButtons=L.Control.extend({includes:L.Mixin.Events,initialize:function(t,e){if(this._content=t,e.titles||(e.titles=[]),e.titles.length<t.length)for(var o=e.titles.length;o<t.length;o++)e.titles.push("");L.Control.prototype.initialize.call(this,e)},onAdd:function(t){this._map=t,this._links=[];for(var e=L.DomUtil.create("div","leaflet-bar"),o=0;o<this._content.length;o++){var i=L.DomUtil.create("a","",e);this._links.push(i),i.href="#",i.style.padding="0 4px",i.style.width="auto",i.style.minWidth="20px",this.options.titles&&this.options.titles.length>o&&(i.title=this.options.titles[o]),this._updateContent(o);var n=L.DomEvent.stopPropagation;L.DomEvent.on(i,"click",n).on(i,"mousedown",n).on(i,"dblclick",n).on(i,"click",L.DomEvent.preventDefault).on(i,"click",this.clicked,this)}return e},_updateContent:function(t){if(!(t>=this._content.length)){var e=this._links[t],o=this._content[t];if("string"==typeof o){var i=o.length<4?"":o.substring(o.length-4),n="data:image/"===o.substring(0,11);".png"===i||".gif"===i||".jpg"===i||n?(e.style.width=""+(this.options.imageSize||26)+"px",e.style.height=""+(this.options.imageSize||26)+"px",e.style.padding="0",e.style.backgroundImage="url("+o+")",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition=this.options.bgPos&&this.options.bgPos.length>t&&this.options.bgPos[t]?-this.options.bgPos[t][0]+"px "+-this.options.bgPos[t][1]+"px":"0px 0px"):e.innerHTML=o}else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(o)}}},setContent:function(t,e){t>=this._content.length||(this._content[t]=e,this._updateContent(t))},setTitle:function(t,e){this.options.titles[t]=e,this._links[t].title=e},setBgPos:function(t,e){this.options.bgPos[t]=e,this._links[t].style.backgroundPosition=e?-e[0]+"px "+-e[1]+"px":"0px 0px"},clicked:function(t){for(var e=t.target,o=this._links.length;--o>=0&&e!==this._links[o];);this.fire("clicked",{idx:o})}}),L.functionButtons=function(t,e){return new L.FunctionButtons(t,e)},L.FunctionButton=L.FunctionButtons.extend({initialize:function(t,e){e.title&&(e.titles=[e.title]),e.bgPos&&(e.bgPos=[e.bgPos]),L.FunctionButtons.prototype.initialize.call(this,[t],e)},setContent:function(t){L.FunctionButtons.prototype.setContent.call(this,0,t)},setTitle:function(t){L.FunctionButtons.prototype.setTitle.call(this,0,t)},setBgPos:function(t){L.FunctionButtons.prototype.setBgPos.call(this,0,t)}}),L.functionButton=function(t,e){return new L.FunctionButton(t,e)},window.MapBBCode.buttonsImage="data:image/png;base64,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","objectParams"in window.MapBBCode||(window.MapBBCode.objectParams=[]),window.MapBBCode.objectParams.unshift({text:!0,reKeys:new RegExp("a^"),applicableTo:function(){return!0},objectToLayer:function(t,e,o){if(e){t._text=e;var i=this._getIcon(t,e,o);i?(t.setIcon(i),t.options.clickable=!1):t.bindPopup(e.replace(new RegExp("<(?!/?("+o.options.allowedHTML+")[ >])","g"),"&lt;"))}else t.options.clickable=!1},_getIcon:function(t,e,o){if(t instanceof L.Marker&&e.length>0){if(L.LetterIcon&&e.length<=o.options.letterIconLength)return new L.LetterIcon(e);if(L.PopupIcon&&e.length<=o.options.popupIconLength&&e.indexOf("<")<0)return new L.PopupIcon(e)}},layerToObject:function(t){return t.inputField?t.inputField.value.replace(/\\n/g,"\n").replace(/\\\n/g,"\\n"):t._text||""},createEditorPanel:function(t,e){if(t instanceof L.Marker){var o=document.createElement("div"),i=document.createTextNode(e.strings.title+": "),n=document.createElement("input");return n.type="text",n.size=20,t._text&&(n.value=t._text.replace(/\\n/g,"\\\\n").replace(/[\r\n]+/g,"\\n")),o.appendChild(i),o.appendChild(n),o.style.marginBottom="8px",t.inputField=n,t.options.draggable=!0,t.defaultIcon=new L.Icon.Default,n.onkeypress=function(e){var o=window.event?(e||window.event).which:e.keyCode;return 27==o||13==o?(t.closePopup(),e.preventDefault(),!1):void 0},t.on("popupopen",function(){n.focus()}),t.on("popupclose",function(){var o=t.inputField.value,i=this._getIcon(t,o,e)||t.defaultIcon;t.setIcon(i)},this),o}}}),window.MapBBCode.include({_layerToObject:function(t){var e={};if(t instanceof L.Marker)e.coords=[t.getLatLng()];else{var o,i=t.getLatLngs(),n=i.length,a=[];for(o=0;n>o;o++)a.push(i[o]);t instanceof L.Polygon&&a.push(a[0]),e.coords=a}return e.params=t._objParams||[],this._eachParamHandler(function(o){if(o.text){var i=o.layerToObject(t,"",this);i&&(e.text=i)}else{var n,a=[];for(n=e.params.length-1;n>=0;n--)o.reKeys.test(e.params[n])&&a.unshift(e.params.splice(n,1));var r=o.layerToObject(t,a,this);if(r&&r.length>0)for(n=0;n<r.length;n++)e.params.push(r[n])}},this,t),e},_makeEditable:function(t,e){var o=document.createElement("div");o.style.textAlign="center",o.style.clear="both";var i=document.createElement("input");if(i.type="button",i.value=this.strings.close,i.onclick=function(){t.closePopup()},o.appendChild(i),e){var n=document.createElement("input");n.type="button",n.value=this.strings.remove,n.onclick=function(){t.closePopup(),e.removeLayer(t)},o.appendChild(n)}var a=document.createElement("div");return t.options.clickable=!0,(t instanceof L.Polyline||t instanceof L.Polygon)&&t.editing.enable(),this._eachParamHandler(function(e){var o=e.createEditorPanel?e.createEditorPanel(t,this):null;o&&a.appendChild(o)},this,t),a.appendChild(o),t.bindPopup(a),t},_findMapInTextArea:function(t){var e=t.selectionStart,o=t.value;if(e>=o.length||o.length<10||o.indexOf("[/map]")<0)return"";var i=o.lastIndexOf("[map",e);if(i>=0){var n=o.indexOf("[/map]",i);if(n+5>=e){var a=o.substring(i,n+6);if(window.MapBBCodeProcessor.isValid(a))return a}}return""},_updateMapInTextArea:function(t,e,o){var i=t.selectionStart,n=t.value;t.value=e.length&&n.indexOf(e)>=0?n.replace(e,o):i>=n.length?n+o:n.substring(0,i)+o+n.substring(i)},_getBBCode:function(t,e){var o=[];return e.eachLayer(function(t){o.push(this._layerToObject(t))},this),window.MapBBCodeProcessor.decimalDigits=this.options.decimalDigits,window.MapBBCodeProcessor.objectsToString({objs:o,zoom:o.length?0:t.getZoom(),pos:o.length?0:t.getCenter()})},editor:function(t,e,o,i){var n=this._createMapPanel(t,!0);if(n){var a=L.map(n,L.extend({},{zoomControl:!1},this.options.leafletOptions));a.addControl(new L.Control.Zoom({zoomInTitle:this.strings.zoomInTitle,zoomOutTitle:this.strings.zoomOutTitle})),L.Control.Search&&a.addControl(new L.Control.Search),this._addLayers(a);var r;"string"!=typeof e&&(r=e,e=this._findMapInTextArea(r));for(var s=new L.FeatureGroup,l=window.MapBBCodeProcessor.stringToObjects(e),p=l.objs,d=0;d<p.length;d++)this._makeEditable(this._objectToLayer(p[d]).addTo(s),s);s.addTo(a),this._zoomToLayer(a,s,{zoom:l.zoom,pos:l.pos},!0),L.drawLocal.draw.toolbar.actions.text=this.strings.cancel,L.drawLocal.draw.toolbar.actions.title=this.strings.drawCancelTitle,L.drawLocal.draw.toolbar.buttons.polyline=this.strings.polylineTitle,L.drawLocal.draw.toolbar.buttons.polygon=this.strings.polygonTitle,L.drawLocal.draw.toolbar.buttons.marker=this.strings.markerTitle,L.drawLocal.draw.handlers.marker.tooltip.start=this.strings.markerTooltip,L.drawLocal.draw.handlers.polyline.tooltip.start=this.strings.polylineStartTooltip,L.drawLocal.draw.handlers.polyline.tooltip.cont=this.strings.polylineContinueTooltip,L.drawLocal.draw.handlers.polyline.tooltip.end=this.strings.polylineEndTooltip,L.drawLocal.draw.handlers.polygon.tooltip.start=this.strings.polygonStartTooltip,L.drawLocal.draw.handlers.polygon.tooltip.cont=this.strings.polygonContinueTooltip,L.drawLocal.draw.handlers.polygon.tooltip.end=this.strings.polygonEndTooltip;var c=new L.Control.Draw({position:"topleft",draw:{marker:!0,polyline:{showLength:!1,guidelineDistance:10,shapeOptions:{color:"#000000",weight:5,opacity:.7}},polygon:this.options.enablePolygons?{showArea:!1,guidelineDistance:10,shapeOptions:{color:"#000000",weight:3,opacity:.7,fillOpacity:this.options.polygonOpacity}}:!1,rectangle:!1,circle:!1},edit:{featureGroup:s,edit:!1,remove:!1}});if(this._eachParamHandler(function(t){t.initDrawControl&&t.initDrawControl(c)}),a.addControl(c),a.on("draw:created",function(t){var e=t.layer;this._eachParamHandler(function(t){t.initLayer&&t.initLayer(e)},this,e),this._makeEditable(e,s),s.addLayer(e),"marker"===t.layerType&&e.openPopup()},this),this.options.editorCloseButtons){var h=L.functionButton("<b>"+this.strings.apply+"</b>",{position:"topleft",title:this.strings.applyTitle});if(h.on("clicked",function(){var t=this._getBBCode(a,s);n.close(),r&&this._updateMapInTextArea(r,e,t),o&&o.call(i,t)},this),a.addControl(h),this.options.uploadButton&&this._upload){var u=L.functionButton(this.strings.upload,{position:"topleft",title:this.strings.uploadTitle});u.on("clicked",function(){this._upload(n,s.getLayers().length?this._getBBCode(a,s):!1,function(t){n.close();var a="["+this.options.shareTag+"]"+t+"[/"+this.options.shareTag+"]";r&&this._updateMapInTextArea(r,e,a),o&&o.call(i,a)})},this),a.addControl(u)}var m=L.functionButton(this.strings.cancel,{position:"topright",title:this.strings.cancelTitle});m.on("clicked",function(){n.close(),o&&o.call(i,null)},this),a.addControl(m)}if(this.options.helpButton){var g=L.functionButton('<span style="font-size: 18px; font-weight: bold;">?</span>',{position:"topright",title:this.strings.helpTitle});g.on("clicked",function(){for(var t="",e=this.strings.helpContents,o="resizable,dialog,scrollbars,height="+this.options.windowHeight+",width="+this.options.windowWidth,i=window.open("","mapbbcode_help",o),n=0;n<e.length;n++)t+=n?"#"===e[n].substr(0,1)?"<h2>"+e[n].replace(/^#\s*/,"")+"</h2>":"<p>"+e[n]+"</p>":"<h1>"+e[0]+"</h1>";t+='<div id="close"><input type="button" value="'+this.strings.close+'" onclick="javascript:window.close();"></div>';var a="<style>body { font-family: sans-serif; font-size: 12pt; } p { line-height: 1.5; } h1 { text-align: center; font-size: 18pt; } h2 { font-size: 14pt; } #close { text-align: center; margin-top: 1em; }</style>";i.document.open(),i.document.write(a),i.document.write(t),i.document.close()},this),a.addControl(g)}return{_ui:this,map:a,close:function(){var t=this.getBBCode();this.map=null,this._ui=null,this.getBBCode=function(){return t},n.close()},getBBCode:function(){return this._ui._getBBCode(a,s)},updateBBCode:function(t,e){var o=window.MapBBCodeProcessor.stringToObjects(t),i=o.objs;s.clearLayers(),a.removeLayer(s);for(var n=0;n<i.length;n++)this._ui._makeEditable(this._ui._objectToLayer(i[n]).addTo(s),s);a.addLayer(s),e||this._ui._zoomToLayer(a,s,{zoom:o.zoom,pos:o.pos},!0)},zoomToData:function(){this._ui.zoomToLayer(a,s)}}}},editorWindow:function(t,e,o){window.storedMapBB={bbcode:t,callback:e,context:o,caller:this};var i=this.options.windowFeatures,n="height="+this.options.windowHeight+",width="+this.options.windowWidth,a=location.href.match(/^(.+\/)([^\/]+)?$/)[1],r=a+this.options.libPath,s=window.open(this.options.usePreparedWindow?"string"==typeof this.options.usePreparedWindow?this.options.usePreparedWindow:r+"mapbbcode-window.html":"","mapbbcode_editor",i+","+n);if(!this.options.usePreparedWindow){var l='<script src="'+r+'leaflet.js"></script>';l+='<script src="'+r+'leaflet.draw.js"></script>',l+='<script src="'+r+'mapbbcode.js"></script>',l+='<script src="'+r+'mapbbcode-config.js"></script>',l+='<link rel="stylesheet" href="'+r+'leaflet.css" />',l+='<link rel="stylesheet" href="'+r+'leaflet.draw.css" />',l+='<div id="edit"></div>',l+="<script>opener.storedMapBB.caller.editorWindowCallback.call(opener.storedMapBB.caller, window, opener.storedMapBB);</script>",s.document.open(),s.document.write(l),s.document.close()}},editorWindowCallback:function(t,e){t.document.body.style.margin=0;var o=new t.MapBBCode(this.options);o.setStrings(this.strings),o.options.editorHeight="100%",o.editor("edit",e.bbcode,function(o){t.close(),e.callback&&e.callback.call(e.context,o),this.storedMapBB=null},this)}}),window.MapBBCode.include({_getEndpoint:function(){var t=this.options.externalEndpoint;if(!t||"http"!==t.substring(0,4))return"";var e=t.substring(t.length-1);return"/"!=e&&"="!=e&&(t+="/"),t},_ajax:function(t,e,o,i){var n;window.XMLHttpRequest?n=new window.XMLHttpRequest:window.ActiveXObject&&(n=new window.ActiveXObject("MSXML2.XMLHTTP.3.0")),n&&(n.onreadystatechange=function(){4==n.readyState&&e.call(o,200==n.status?!1:n.status||499,n.responseText)},i?(n.open("POST",t,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(i)):(n.open("GET",t,!0),n.send(null)))},showExternal:function(element,id,callback,context){var endpoint=this._getEndpoint();if(endpoint&&id){var showMap=function(error,content){var show,result,derror=!1;if(error?derror=!0:result=eval("("+content+")"),error||result.error||!result.bbcode){var errorDiv=this._createMapPanel(element);errorDiv.style.display="table";var cell=document.createElement("div");cell.style.display="table-cell",cell.style.width="100%",cell.style.backgroundColor="#ddd",cell.style.textAlign="center",cell.style.verticalAlign="middle",cell.innerHTML=this.strings.sharedCodeError.replace("{url}",endpoint+id),errorDiv.appendChild(cell),show={close:function(){errorDiv.close()}}}else if(show=this.show(element,result.bbcode),result.title,show){var map=show.map;if(!this.options.outerLinkTemplate){var outer=L.functionButton(window.MapBBCode.buttonsImage,{position:"topright",bgPos:[52,0],title:this.strings.outerTitle});outer.on("clicked",function(){window.open(endpoint+id,"mapbbcode_outer")},this),map.addControl(outer)}if(L.ExportControl){var ec=new L.ExportControl({name:this.strings.exportName,title:this.strings.exportTitle,endpoint:endpoint,codeid:id});map.addControl(ec)}}callback&&callback.call(context||this,show)};this._ajax(endpoint+id+"?api=1",showMap,this)}},_upload:function(mapDiv,bbcode,callback){var outerDiv=document.createElement("div");outerDiv.style.display="table",outerDiv.style.backgroundColor="rgba(0, 0, 0, 0.8)",outerDiv.style.zIndex=2e3,outerDiv.style.position="absolute",outerDiv.style.left=outerDiv.style.right=outerDiv.style.top=outerDiv.style.bottom=0,outerDiv.style.width=outerDiv.style.height="100%",mapDiv.appendChild(outerDiv);var back=document.createElement("div");back.style.width=back.style.height="100%",back.style.textAlign="center",back.style.color="white",back.style.verticalAlign="middle",back.style.display="table-cell",back.style.cursor="default";var stop=L.DomEvent.stopPropagation;L.DomEvent.on(back,"click",stop).on(back,"mousedown",stop).on(back,"dblclick",stop),outerDiv.appendChild(back);var cancel=document.createElement("input"),endpoint=this._getEndpoint();if(bbcode){var message=document.createElement("div");message.innerHTML=this.strings.uploading+"...",back.appendChild(message),this._ajax(endpoint+"save?api=1",function(error,content){if(error)message.innerHTML=this.strings.uploadError+": "+error;else{var result=eval("("+content+")");if(result.error||!result.codeid)message.innerHTML=this.strings.uploadError+":<br>"+result.error;else{message.innerHTML=this.strings.uploadSuccess+':<br><a href="'+result.editurl+'" target="editmap" style="line-height: 40px; color: #ccf">'+result.editurl+"</a>";var sthis=this;cancel.onclick=function(){mapDiv.removeChild(outerDiv),callback.call(sthis,result.codeid)}}}},this,"title=&bbcode="+encodeURIComponent(bbcode).replace(/%20/g,"+"))}else{var descDiv=document.createElement("div");descDiv.innerHTML=this.strings.sharedFormHeader,back.appendChild(descDiv);var inputDiv=document.createElement("div"),url=document.createElement("input");url.type="text",url.size=40,inputDiv.appendChild(url);var urlBtn=document.createElement("input");urlBtn.type="button",urlBtn.value=this.strings.apply,inputDiv.appendChild(urlBtn),back.appendChild(inputDiv),url.focus();var errorDiv=document.createElement("div");errorDiv.style.color="#fcc",errorDiv.style.display="none",back.appendChild(errorDiv);var checkCode=function(){errorDiv.style.display="none";var t=new RegExp("(?:/|^)([a-z]+)\\s*$").exec(url.value);if(t){var e=t[1];this._ajax(endpoint+e+"?api=1",function(t,o){t?(errorDiv.innerHTML=this.strings.sharedFormError,errorDiv.style.display="block"):o.substr(0,15).indexOf('"error"')>0?(url.value="",errorDiv.innerHTML=this.strings.sharedFormInvalidCode,errorDiv.style.display="block"):(mapDiv.removeChild(outerDiv),callback.call(this,e))},this)}};L.DomEvent.on(urlBtn,"click",checkCode,this),L.DomEvent.on(url,"keypress",function(t){var e=window.event?(t||window.event).which:t.keyCode;13==e?checkCode.call(this):27==e&&mapDiv.removeChild(outerDiv)},this)}cancel.type="button",cancel.value=this.strings.close,cancel.style.marginTop="30px",cancel.onclick=function(){mapDiv.removeChild(outerDiv)},back.appendChild(cancel)}}),"objectParams"in window.MapBBCode||(window.MapBBCode.objectParams=[]),window.MapBBCode.objectParams.push({lineColors:{def:"#0022dd",blue:"#0022dd",red:"#bb0000",green:"#007700",brown:"#964b00",purple:"#800080",black:"#000000"},reKeys:new RegExp("^(blue|red|green|brown|purple|black)$"),applicableTo:function(t){return t instanceof L.Polygon||t instanceof L.Polyline},objectToLayer:function(t,e){var o=this.lineColors,i=e.length>0&&e[0]in o?o[e[0]]:o.def;t.options.color=i,t instanceof L.Polygon&&(t.options.fillColor=i)},layerToObject:function(t,e){return t._colorName?this.lineColors[t._colorName]!==this.lineColors.def?[t._colorName]:[]:e},initLayer:function(){},initDrawControl:function(t){t.options.draw.polyline.shapeOptions.color=this.lineColors.def,t.options.draw.polygon.shapeOptions.color=this.lineColors.def},createEditorPanel:function(t){var e,o=document.createElement("div"),i=[],n=this.lineColors;for(e in n)"string"==typeof n[e]&&"#"===n[e].substring(0,1)&&i.push(e);i=i.sort(),o.style.width=10+20*i.length+"px",o.textAlign="center";for(var a=function(e){var i=e.target.style;if("white"==i.borderColor){t.setStyle({color:i.backgroundColor,fillColor:i.backgroundColor}),t._colorName=e.target._colorName;for(var n=o.childNodes,a=0;a<n.length;a++)n[a].style.borderColor="white";i.borderColor="#aaa"}},r=0;r<i.length;r++)if("def"!==i[r]){var s=document.createElement("div");s._colorName=i[r],s.style.width="16px",s.style.height="16px",s.style.cssFloat="left",s.style.styleFloat="left",s.style.marginRight="3px",s.style.marginBottom="5px",s.style.cursor="pointer";var l=n[i[r]];s.style.backgroundColor=l,s.style.borderWidth="3px",s.style.borderStyle="solid",s.style.borderColor=l==t.options.color?"#aaa":"white",s.onclick=a,o.appendChild(s)}var p=document.createElement("div");return p.style.clear="both",o.appendChild(p),o}}),L.LetterIcon=L.Icon.extend({options:{className:"leaflet-div-icon",color:"black",radius:11},initialize:function(t,e){this._letter=t,L.setOptions(this,e)},createIcon:function(){var t=this.options.radius,e=2*t+1,o=document.createElement("div");return o.innerHTML=this._letter,o.className="leaflet-marker-icon",o.style.marginLeft=-t-2+"px",o.style.marginTop=-t-2+"px",o.style.width=e+"px",o.style.height=e+"px",o.style.borderRadius=t+2+"px",o.style.borderWidth="2px",o.style.borderColor="white",o.style.fontSize="10px",o.style.fontFamily="sans-serif",o.style.fontWeight="bold",o.style.textAlign="center",o.style.lineHeight=e+"px",o.style.color="white",o.style.backgroundColor=this.options.color,this._setIconStyles(o,"icon"),o},createShadow:function(){return null}}),L.letterIcon=function(t,e){return new L.LetterIcon(t,e)},L.PopupIcon=L.Icon.extend({options:{width:150},initialize:function(t,e){L.Icon.prototype.initialize.call(this,e),this._text=t},createIcon:function(){var t=document.createElement("div"),e=document.createElement("div"),o=this.options.width;t.style.position="absolute",e.style.position="absolute",e.style.width=o+"px",e.style.bottom="-3px",e.style.left=-o/2+"px";var i=document.createElement("div");i.innerHTML=this._text,i.style.textAlign="center",i.style.lineHeight="1.2",i.style.backgroundColor="white",i.style.boxShadow="0px 1px 10px rgba(0, 0, 0, 0.655)",i.style.padding="4px 7px",i.style.borderRadius="5px",i.style.margin="0 auto",i.style.display="table";var n=document.createElement("div");n.className="leaflet-popup-tip-container",n.style.width="20px",n.style.height="11px";var a=document.createElement("div");return a.className="leaflet-popup-tip",a.style.width=a.style.height="8px",a.style.marginTop="-5px",a.style.boxShadow="none",n.appendChild(a),e.appendChild(i),e.appendChild(n),t.appendChild(e),t},createShadow:function(){return null}}),L.popupIcon=function(t,e){return new L.PopupIcon(t,e)},L.Control.Search=L.Control.extend({options:{position:"topleft",title:"Nominatim Search",email:""},onAdd:function(t){this._map=t;var e=L.DomUtil.create("div","leaflet-bar"),o=document.createElement("div");e.appendChild(o);var i=L.DomUtil.create("a","",o);i.href="#",i.style.width="26px",i.style.height="26px",i.style.backgroundImage="url("+this._icon+")",i.style.backgroundSize="26px 26px",i.style.backgroundRepeat="no-repeat",i.title=this.options.title;var n=L.DomEvent.stopPropagation;L.DomEvent.on(i,"click",n).on(i,"mousedown",n).on(i,"dblclick",n).on(i,"click",L.DomEvent.preventDefault).on(i,"click",this._toggle,this);var a=this._form=document.createElement("form");a.style.display="none",a.style.position="absolute",a.style.left="27px",a.style.top="0px",a.style.zIndex=-10;var r=this._input=document.createElement("input");return r.style.height="25px",r.style.border="1px solid grey",r.style.padding="0 0 0 10px",a.appendChild(r),L.DomEvent.on(a,"submit",function(){return this._doSearch(r.value),!1},this).on(a,"submit",L.DomEvent.preventDefault),e.appendChild(a),e},_toggle:function(){"block"!=this._form.style.display?(this._form.style.display="block",this._input.focus()):this._collapse()},_collapse:function(){this._form.style.display="none",this._input.value=""},_nominatimCallback:function(t){if(t&&t.length>0){var e=t[0].boundingbox;this._map.fitBounds(L.latLngBounds([[e[0],e[2]],[e[1],e[3]]]))}this._collapse()},_callbackId:0,_doSearch:function(t){var e="_l_osmgeocoder_"+this._callbackId++;window[e]=L.Util.bind(this._nominatimCallback,this);var o={q:t,format:"json",limit:1,json_callback:e};this.options.email&&(o.email=this.options.email),this._map.getBounds()&&(o.viewbox=this._map.getBounds().toBBoxString());var i="http://nominatim.openstreetmap.org/search"+L.Util.getParamString(o),n=document.createElement("script");n.type="text/javascript",n.src=i,document.getElementsByTagName("head")[0].appendChild(n)
},_icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAL/wAAC/8Bk9f7AQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAOnSURBVGiB7ZhPaBxVHMc/vxezuzlsQqQqFf+Af8CLoWgsNHjoYjazbrR4SsGbgkcPInooLb1YRdBDQRCtCp6E3NLDZmendRXpaiC1kXqwh17EixQsmxATk935edhJHELczbydskOZz+m937zf+73v/Gbe+82IqnI3YQa9gLhJBSWdVFDSSQUlnVRQ0kkFJZ174p6wXC5nVXXC9/2RXC53bWFhYS3uGN2QOIrTQqFwKJPJnAGeB54GhoNLCtwAlowxHywuLt7oO1gP+hbkOM4rwGfA/T2GbojIKdd1z+sdLPH7EuQ4zufAGyHTH8BPIrKsqn8Dk8BR4KmdAar63fb29ov1en3TOnAXrN8hx3Fe5z8x/4jI2dHR0Y/m5+fb+4w9KSKfqOohETmezWbPAW/bxu6GVYbK5fJD7Xb7V2AMWPd9/5jnedd7+NzXbrd/BB4HfBE5Xq1Wf7BadRestu1Wq3WejhiAd3uJAahUKrdE5DU6G4VR1S9tYvcisiDpUAy6S7Va7dOD+gYZ+SLoPuk4zsNR4/cisqBisfgEkAdQVTfqjqWqi6H2ZNT4vbDJ0DOh7tWo/qq662OMGbwg4IGdhoj8GdV5fX39Fp33CN/3D1vE70pkQar6S6h9JKp/Pp+fAARARK5F9e+FjaAVgjssIs9axNz1McYsW/h3JbIgz/OawM2ge7JYLD5yUN9CoZAD3gy67WazuRI1fi+sziER+ThojhpjLhzUb3h4+D2CMkhVLzQajQ2b+F3XZlMpiIg4juOp6guB6auhoaG3KpXK6n7j5+bmhprN5jvAOTo3sRVUClesV/5/a7MtTmdnZx9ttVrXCc4k4HcROWOMuVKpVG4ClEqlw8BRVT1Np1ANc1tEpqvV6s+2i9+PvqrtmZmZIyLyNTCx59JtYAN4cI99E8iF+n/5vj/teV5su11fn+C1Wm1lbGzsORF5HwhX2ePsESMi36jqYyLihsz3GmMul0ql8GHdF7F8sUKnAm+1WseMMZNBSTOiqldFZBlYcl33N+jsdJlMZgGYCbnH9vjFJigKgaiLQDFkjkXUQP761Ov1za2trROAFzKPq+qlfh+/gWRoh6mpqZF8Pn8RmA6Z+8rUQP/LNRqNjbW1tRPApZC5r0wN/EfjjigRuRwyjwNnbeYbuCDoiFpdXX0Z+DYwfa+qr9rMlQhBsJupl1T1w2w2W3Zdd91mnoFuCneCxGQoLlJBSScVlHRSQUknFZR0UkFJ564T9C+LGmRQ/iQvLwAAAABJRU5ErkJggg=="}),L.control.search=function(t){return new L.Control.Search(t)},L.ExportControl=L.Control.extend({includes:L.Mixin.Events,options:{position:"topleft",name:"Export",title:"",endpoint:"http://share.mapbbcode.org/",codeid:"",types:!1,titles:!1},onAdd:function(){var t=L.DomUtil.create("div","leaflet-bar"),e=document.createElement("div");t.appendChild(e);var o=L.DomUtil.create("a","",e);o.href="#",o.innerHTML=this.options.name,o.title=this.options.title||"",o.style.height="26px",o.style.width="auto",o.style.padding="0 4px";var i=this._variants=document.createElement("div");i.style.display="none",i.style.position="absolute",i.style.left="50px",i.style.top="0px",i.style.width="200px",i.style.padding="0 6px",i.style.backgroundColor="white",i.style.zIndex=-10,t.appendChild(i);var n=L.DomEvent.stopPropagation;return L.DomEvent.on(o,"click",n).on(o,"mousedown",n).on(o,"dblclick",n).on(o,"click",L.DomEvent.preventDefault).on(o,"click",function(){i.style.display="block"==i.style.display?"none":"block"}),this.options.types&&this.options.titles?this._updateVariants():this._ajax(this.options.endpoint+"fmtlist",function(t){t&&t.titles&&t.titles.length>0&&t.types&&t.types.length==t.titles.length&&(this.options.titles=t.titles,this.options.types=t.types,this._updateVariants())},this),t},_updateVariants:function(){var t,e=this.options.types,o=this.options.titles,i=this.options.codeid,n=this._variants;for(t=0;t<e.length;t++){t>0&&n.appendChild(document.createTextNode(" | "));var a=document.createElement("a");a.style.display="inline",a.style.width="auto",a.style.color="blue",a.style.border="none",a.style.textDecoration="none",a.innerHTML=o[t];var r=L.DomEvent.stopPropagation;i?(a.href=this.options.endpoint+i+"?format="+e[t],L.DomEvent.on(a,"click",r).on(a,"mousedown",r).on(a,"dblclick",r).on(a,"click",this._linkClick,this)):(a.href="#",a._etype=e[t],L.DomEvent.on(a,"click",r).on(a,"mousedown",r).on(a,"dblclick",r).on(a,"click",L.DomEvent.preventDefault).on(a,"click",this._linkClick,this)),n.appendChild(a)}},_linkClick:function(t){this._variants.style.display="none",this.fire("export",{fmt:t.target._etype})},_ajax:function(url,func,context){var http=null;window.XMLHttpRequest?http=new window.XMLHttpRequest:window.ActiveXObject&&(http=new window.ActiveXObject("MSXML2.XMLHTTP.3.0")),http.onreadystatechange=function(){if(4==http.readyState&&200==http.status){var result=eval("("+http.responseText+")");func.call(context,result)}},http.open("GET",url,!0),http.send(null)}}),L.exportControl=function(t){return new L.ExportControl(t)},window.MapBBCode.include({strings:{close:"Close",remove:"Delete",apply:"Apply",cancel:"Cancel",title:"Title",zoomInTitle:"Zoom in",zoomOutTitle:"Zoom out",applyTitle:"Apply changes",cancelTitle:"Cancel changes",fullScreenTitle:"Enlarge or shrink map panel",helpTitle:"Open help window",outerTitle:"Show this place on an external map",exportName:"Export",exportTitle:"Download this map",upload:"Upload",uploadTitle:"Upload this map to an external server",uploading:"Uploading",uploadError:"Error while uploading the map",uploadSuccess:"Upload was successful. Bookmark this link to be able to edit the map",sharedFormHeader:"There are no objects to upload. Enter a MapBBCode Share map URL",sharedFormError:"This map panel has incorrect endpoint set.<br>Please contact an administrator.",sharedFormInvalidCode:"Map code is invalid",sharedCodeError:'Failed to download an external map<br><br><a href="{url}" target="mapbbcode_outer">Open map in a new window</a>',polylineTitle:"Draw a path",markerTitle:"Add a marker",drawCancelTitle:"Cancel drawing",markerTooltip:"Click map to place marker",polylineStartTooltip:"Click to start drawing a line",polylineContinueTooltip:"Click to continue drawing line",polylineEndTooltip:"Click the last point to finish line",polygonStartTooltip:"Click to start drawing a polygon",polygonContinueTooltip:"Click to continue drawing polygon",polygonEndTooltip:"Click the last point to close this polygon",helpContents:["Map BBCode Editor",'You have opened this help window from inside the map editor. It is activated with "Map" button. When the cursor in the textarea is inside [map] sequence, the editor will edit that bbcode, otherwise it will create new bbcode and insert it at cursor position after clicking "Apply".',"# BBCode","Map BBCode is placed inside <tt>[map]...[/map]</tt> tags. Opening tag may contain zoom with optional position in latitude,longitude format: <tt>[map=10]</tt> or <tt>[map=15,60.1,30.05]</tt>. Decimal separator is always a full stop.",'The tag contains a semicolon-separated list of features: markers and paths. They differ only by a number of space-separated coordinates: markers have one, and paths have more. There can be optional title in brackets after the list: <tt>12.3,-5.1(Popup)</tt> (only for markers in the editor). Title is HTML and can contain any characters, but "(" should be replaced with "\\(", and only a limited set of HTML tags is allowed.','Paths can have different colours, which are stated in <i>parameters</i>: part of a title followed by "|" character. For example, <tt>12.3,-5.1 12.5,-5 12,0 (red|)</tt> will produce a red path.',"# Map Viewer",'Plus and minus buttons on the map change its zoom. Other buttons are optional. A button with four arrows ("fullscreen") expands map view to maximum width and around twice the height. If a map has many layers, there is a layer switcher in the top right corner. There also might be a button with a curved arrow, that opens an external site (usually www.openstreetmap.org) at a position shown on the map.',"You can drag the map to pan around, press zoom buttons while holding Shift key to change zoom quickly, or drag the map with Shift pressed to zoom to an area. Scroll-wheel zoom is disabled in viewer to not interfere with page scrolling, but in works in map editor.","# Editor Buttons",'"Apply" saves map features (or map state if there are none) to a post body, "Cancel" just closes the editor panel. And you have already figured out what the button with a question mark does. Two buttons underneath zoom controls add features on the map.','To draw a path, press the button with a diagonal line and click somewhere on the map. Then click again, and again, until you\'ve got a nice polyline. Do not worry if you got some points wrong: you can fix it later. Click on the final point to finish drawing. Then you may fix points and add intermediate nodes by dragging small square or circular handlers. To delete a path (or a marker), click on it, and in the popup window press "Delete" button.',"Markers are easier to place: click on the marker button, then click on the map. In a popup window for a marker you can type a title: if it is 1 or 2 characters long, the text would appear right on the marker. Otherwise map viewers would have to click on a marker to read the title. A title may contain URLs and line feeds.","# Plugin",'Map BBCode Editor is an open source product, available at <a href="https://github.com/MapBBCode/mapbbcode">github</a>. You will also find there plugins for some of popular forum engines. All issues and suggestions can be placed in the github issue tracker.']}})}(window,document);